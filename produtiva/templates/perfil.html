{% extends "base.html" %}

{% load static %}

{% block title %}Meu Perfil - Produtiva{% endblock %}

{% block header_right_content %}
  <div class="flex items-center space-x-2">
    {% if user.is_authenticated %}
        <a
            href="{% url 'perfil' %}"
            class="group flex items-center text-gray-800 font-medium hidden md:flex hover:text-indigo-600 transition-colors duration-200"
        >
            <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5 mr-1.5 text-gray-500 group-hover:text-indigo-600 transition-colors duration-200"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
            >
            <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
            />
            </svg>
            <span>{{ user.first_name }}</span>
        </a>
        <a
            href="{% url 'logout' %}"
            class="text-red-600 hover:text-red-800 font-medium hidden md:inline-block transition-colors duration-200"
            >Sair</a
        >
    {% else %}
      <a
        href="{% url 'login' %}"
        class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition-colors duration-200"
      >
        Faça Login
      </a>
    {% endif %}
  </div>
{% endblock header_right_content %}

{% block 'body' %}
<div class="container mx-auto p-6 max-w-2xl">
    <div class="bg-white p-8 rounded-lg shadow-md border border-gray-200">
        
        <h1 class="text-2xl font-bold text-gray-800 mb-2">Meu Perfil</h1>
        <p class="text-gray-600 mb-6">Atualize as suas informações pessoais e senha.</p>

        {% if messages %}
            <div class="mb-6 space-y-2">
                {% for message in messages %}
                <div class="w-full text-center py-2 px-4 rounded-md {% if message.tags == 'success' %}bg-green-100 text-green-800{% elif message.tags == 'error' %}bg-red-100 text-red-800{% else %}bg-blue-100 text-blue-800{% endif %}">
                    {{ message }}
                </div>
                {% endfor %}
            </div>
        {% endif %}

        <form action="{% url 'perfil' %}" method="post" class="space-y-4">
            {% csrf_token %}

            <!-- SEÇÃO DE INFORMAÇÕES PESSOAIS -->
            <div>
                <label for="first_name" class="block text-sm font-medium text-gray-700">Nome</label>
                <input 
                    type="text" 
                    name="first_name" 
                    id="first_name" 
                    value="{{ user.first_name }}"
                    class="mt-1 block w-full rounded-md bg-gray-100 px-3 py-2 text-base text-gray-800 outline outline-1 outline-gray-300 placeholder:text-gray-500 focus:outline-2 focus:outline-indigo-500"
                    required
                >
            </div>

            <div>
                <label for="last_name" class="block text-sm font-medium text-gray-700">Apelido</label>
                <input 
                    type="text" 
                    name="last_name" 
                    id="last_name" 
                    value="{{ user.last_name }}"
                    class="mt-1 block w-full rounded-md bg-gray-100 px-3 py-2 text-base text-gray-800 outline outline-1 outline-gray-300 placeholder:text-gray-500 focus:outline-2 focus:outline-indigo-500"
                    required
                >
            </div>

            <div>
                <label for="email" class="block text-sm font-medium text-gray-700">E-mail</label>
                <input 
                    type="email" 
                    name="email" 
                    id="email" 
                    value="{{ user.email }}"
                    class="mt-1 block w-full rounded-md bg-gray-100 px-3 py-2 text-base text-gray-800 outline outline-1 outline-gray-300 placeholder:text-gray-500 focus:outline-2 focus:outline-indigo-500"
                    required
                >
            </div>

            <hr class="my-6">

            <h2 class="text-lg font-semibold text-gray-700">Alterar Senha</h2>
            <p class="text-sm text-gray-500 -mt-3">Deixe os campos abaixo em branco se não desejar alterar a sua senha.</p>
            
            {% if password_form.non_field_errors %}
                <div class="bg-red-100 text-red-800 p-3 rounded-md">
                    {% for error in password_form.non_field_errors %}
                        <p>{{ error }}</p>
                    {% endfor %}
                </div>
            {% endif %}

            <div>
                <label for="{{ password_form.old_password.id_for_label }}" class="block text-sm font-medium text-gray-700">Senha Antiga</label>
                <input type="password" name="{{ password_form.old_password.html_name }}" id="{{ password_form.old_password.id_for_label }}" class="mt-1 block w-full rounded-md bg-gray-100 px-3 py-2 text-base text-gray-800 outline outline-1 outline-gray-300 placeholder:text-gray-500 focus:outline-2 focus:outline-indigo-500">
                {% if password_form.old_password.errors %}
                    <div class="text-red-600 text-sm mt-1">{{ password_form.old_password.errors.0 }}</div>
                {% endif %}
            </div>

            <div>
                <label for="{{ password_form.new_password1.id_for_label }}" class="block text-sm font-medium text-gray-700">Nova Senha</label>
                <input type="password" name="{{ password_form.new_password1.html_name }}" id="{{ password_form.new_password1.id_for_label }}" class="mt-1 block w-full rounded-md bg-gray-100 px-3 py-2 text-base text-gray-800 outline outline-1 outline-gray-300 placeholder:text-gray-500 focus:outline-2 focus:outline-indigo-500">
                {% if password_form.new_password1.errors %}
                    <div class="text-red-600 text-sm mt-1">{{ password_form.new_password1.errors.0 }}</div>
                {% endif %}
            </div>

            <div>
                <label for="{{ password_form.new_password2.id_for_label }}" class="block text-sm font-medium text-gray-700">Confirmação da Nova Senha</label>
                <input type="password" name="{{ password_form.new_password2.html_name }}" id="{{ password_form.new_password2.id_for_label }}" class="mt-1 block w-full rounded-md bg-gray-100 px-3 py-2 text-base text-gray-800 outline outline-1 outline-gray-300 placeholder:text-gray-500 focus:outline-2 focus:outline-indigo-500">
                {% if password_form.new_password2.errors %}
                    <div class="text-red-600 text-sm mt-1">{{ password_form.new_password2.errors.0 }}</div>
                {% endif %}
            </div>

            <div class="flex justify-end pt-4">
                <button 
                    type="submit"
                    class="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-md shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
                >
                    Salvar Alterações
                </button>
            </div>
        </form>

        {% if password_form.new_password1.help_text %}
            <div class="mt-6 text-sm text-gray-500 bg-gray-50 p-4 rounded-md border">
                {{ password_form.new_password1.help_text|safe }}
            </div>
        {% endif %}
    </div>
</div>

{% endblock 'body' %}